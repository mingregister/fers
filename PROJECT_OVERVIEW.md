# FERS - File Encrypt & Remote Storage

## 项目概述

FERS (File Encrypt & Remote Storage) 是一个基于Go语言开发的文件加密和远程存储管理工具。该项目提供了一个图形用户界面，允许用户将本地文件加密后上传到阿里云OSS存储，以及从远程存储下载并解密文件。

## 核心功能

- **文件加密**: 使用AES-GCM算法对文件进行加密
- **远程存储**: 支持阿里云OSS对象存储
- **图形界面**: 基于Fyne框架的跨平台GUI应用
- **同步功能**: 支持本地与远程文件的双向同步
- **目录浏览**: 支持在工作目录内进行文件和目录浏览

## 项目架构

### 目录结构

```
fers/
├── main.go                 # 应用程序入口
├── pkg/
│   ├── config/            # 配置管理
│   │   └── config.go
│   ├── crypto/            # 加密解密
│   │   └── crypto.go
│   ├── storage/           # 存储接口和实现
│   │   ├── client.go      # 存储客户端接口
│   │   ├── oss_client.go  # OSS客户端实现
│   │   └── oss_mock.go    # Mock实现
│   ├── dir/               # 目录和文件管理
│   │   ├── dir.go         # 目录操作
│   │   └── filemanager.go # 文件管理器
│   └── appui/             # 用户界面
│       └── ui.go
├── config.yaml            # 配置文件
└── go.mod                 # Go模块依赖
```

### 核心模块

#### 1. 配置管理 (`pkg/config`)

- **功能**: 管理应用程序配置，包括加密密钥、日志路径、目标目录和OSS配置
- **配置项**:
  - `crypto_key`: 加密密钥
  - `log`: 日志文件路径
  - `target_dir`: 工作目录
  - `oss`: OSS相关配置（endpoint、access_key等）
- **特点**: 使用Viper库支持YAML配置文件，支持多路径搜索

#### 2. 加密模块 (`pkg/crypto`)

- **算法**: AES-GCM (Galois/Counter Mode)
- **密钥生成**: 使用SHA256对用户密码进行哈希
- **安全特性**:
  - 每次加密生成随机nonce
  - 提供认证加密，确保数据完整性
- **接口设计**: 定义了`Cipher`接口，支持加密和解密操作

#### 3. 存储模块 (`pkg/storage`)

- **接口抽象**: 定义了`Client`接口，支持List、Upload、Download操作
- **OSS实现**: 基于阿里云OSS SDK v2
- **功能特性**:
  - 支持工作目录前缀管理
  - 自动处理路径格式转换
  - 支持大文件分页列表

#### 4. 文件管理 (`pkg/dir`)

- **核心组件**: `FileManager`负责协调加密、存储和本地文件操作
- **主要功能**:
  - 单文件/目录的加密上传
  - 文件下载和解密
  - 双向同步（上传缺失的本地文件，下载缺失的远程文件）
  - 本地文件删除
- **安全特性**: 路径验证，防止目录遍历攻击

#### 5. 用户界面 (`pkg/appui`)

- **框架**: 基于Fyne v2的跨平台GUI
- **界面特性**:
  - 文件/目录浏览器
  - 目录导航（上级目录、进入目录）
  - 操作按钮（加密上传、同步下载、特定文件下载等）
  - 远程文件选择对话框
  - 操作取消功能
- **用户体验**: 支持多选下载、操作进度反馈、错误提示

## 技术栈

### 主要依赖

- **Go 1.24.6**: 编程语言
- **Fyne v2.6.3**: GUI框架
- **阿里云OSS SDK v2**: 对象存储客户端
- **Viper v1.21.0**: 配置管理
- **标准库**: crypto/aes, crypto/cipher等加密库

### 加密技术

- **算法**: AES-256-GCM
- **密钥管理**: 基于用户密码的SHA256哈希
- **随机性**: 使用crypto/rand生成安全随机数

## 使用流程

### 1. 配置设置

创建`config.yaml`文件，配置以下信息：

```yaml
crypto_key: "your-encryption-password"
log: "app.log"
target_dir: "/path/to/working/directory"
oss:
  enabled: true
  endpoint: "oss-cn-hangzhou.aliyuncs.com"
  access_key_id: "your-access-key"
  access_key_secret: "your-secret-key"
  bucket_name: "your-bucket"
  region: "cn-hangzhou"
  workDir: "your-remote-folder"
```

### 2. 应用启动

- 应用启动时会初始化配置、日志、存储客户端和加密组件
- 创建文件管理器和用户界面
- 显示工作目录的文件列表

### 3. 主要操作

- **加密上传**: 选择文件/目录，点击"Encrypt & Upload"
- **同步下载**: 点击"Sync Download"下载远程缺失的文件
- **特定下载**: 点击"Download Specific"选择特定远程文件下载
- **同步上传**: 点击"Sync Upload"上传本地缺失的文件
- **删除本地文件**: 选择文件，点击"Delete Local File"

## 安全特性

### 数据安全

- **端到端加密**: 文件在本地加密后上传，下载后在本地解密
- **密钥安全**: 加密密钥不会传输到远程服务器
- **完整性保护**: AES-GCM提供认证加密，确保数据未被篡改

### 访问控制

- **工作目录限制**: 所有操作限制在配置的工作目录内
- **路径验证**: 防止目录遍历攻击
- **权限检查**: 文件操作前进行权限验证

## 扩展性设计

### 接口抽象

- **存储接口**: `storage.Client`接口支持多种存储后端
- **加密接口**: `crypto.Cipher`接口支持多种加密算法
- **模块化设计**: 各模块职责清晰，便于维护和扩展

### 可扩展点

- 支持其他云存储服务（通过实现`storage.Client`接口）
- 支持其他加密算法（通过实现`crypto.Cipher`接口）
- 支持其他UI框架（通过重新实现UI层）

## 开发和构建

### 环境要求

- Go 1.24.6+
- 支持CGO（Fyne框架要求）

### 构建命令

```bash
# 开发模式运行
go run main.go

# 构建可执行文件
go build -o fers main.go

# 使用提供的构建脚本
./build.bat  # Windows
```

### 配置文件位置

应用会按以下顺序搜索配置文件：

1. 当前工作目录
2. 可执行文件所在目录
3. 用户主目录

## 日志和监控

- **结构化日志**: 使用slog库记录结构化日志
- **日志级别**: 支持Debug级别，包含源码位置信息
- **操作追踪**: 记录所有文件操作的成功/失败状态
- **错误处理**: 详细的错误信息和用户友好的错误提示

## 注意事项

### 安全建议

- 定期备份加密密钥
- 使用强密码作为加密密钥
- 妥善保管OSS访问凭证
- 定期检查远程存储的访问日志

### 使用限制

- 文件操作限制在配置的工作目录内
- 大文件上传可能需要较长时间
- 网络中断可能影响同步操作

### 性能考虑

- 加密/解密操作会消耗CPU资源
- 大量小文件的同步可能较慢
- 建议在稳定网络环境下使用

## 故障排除

### 常见问题

1. **配置文件未找到**: 确保config.yaml在正确位置
2. **OSS连接失败**: 检查网络连接和OSS配置
3. **加密失败**: 检查密钥配置和文件权限
4. **UI无法启动**: 确保系统支持图形界面

### 日志分析

- 查看应用日志文件了解详细错误信息
- 关注ERROR级别的日志消息
- 检查操作的开始和完成日志

这个项目提供了一个完整的文件加密和远程存储解决方案，适合需要安全存储敏感文件的个人用户和小型团队使用。
